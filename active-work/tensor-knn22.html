



<script src="https://unpkg.com/deeplearn@0.5.1/dist/deeplearn.js"> </script> 
Version 32<br><br>
<h2 align=center>CSV to K Nearest Neighbor (KNN) Classifier</h2>



<script>



// helper function for very last step

function flatten(arr) {
  return [].concat(...arr)
}


function findIndexOfGreatest(array) {
  var greatest;
  var indexOfGreatest;
  for (var i = 0; i < array.length; i++) {
    if (!greatest || array[i] > greatest) {
      greatest = array[i];
      indexOfGreatest = i;
    }
  }
  return indexOfGreatest;
}
</script>



Original CSV:<br><textarea id="myArea02" rows=10 cols=100 nowrap placeholder="length,width,height,label&#10;2,3,4,small&#10;4,6,7,big">
sepal_length,sepal_width,petal_length,petal_width,species
5.1,3.5,1.4,0.2,setosa
4.9,3,1.4,0.2,setosa
4.7,3.2,1.3,0.2,setosa</textarea><br><br>

<input type=button value="Seperate Data and Labels" onclick="{
 
   document.getElementById('myArea01').value = '' 
   document.getElementById('myText02').value = '' 
   document.getElementById('myText03').value = '' 
   document.getElementById('myLabelsSpot').innerHTML = ''                                                          
                                                                                                              
                                                                                                           
                                                                                                              
                                                             
                                                             
                                                             
                                                             
//  alert('not yet ready\nUsing the testing data below') 
  //myIncoming = new Array()                                                           
 myIncoming = document.getElementById('myArea02').value.split(/\r\n|\n/)                                                    
// alert(myIncoming.length)    
                                                            
  myLabelsTemp = new Array(myIncoming.length)
   myInSplit =    new Array(myIncoming.length)                                                       
 for(var t=0;  t <= myIncoming.length-1; t++){
       myInSplit[t] =  myIncoming[t].split(',')                                                   
     //  myLabelsTemp[t]  = myInSplit[t].shift()                                                    
}                                                                                                                        
      
// alert()                                                          
                                                             
//alert( myInSplit[0])  
                                                             
//alert(myLabelsTemp)                                                          
                                                             
                                                                                                          
 // put label label in table    
                                                             
  Lab =     myInSplit[0].pop()                                                          
                                                             
 document.getElementById('myLabelsSpot').innerHTML =  Lab
                                                             
                                                                                              
 document.getElementById('myText03').value =  myInSplit[0]                                                         
                                                             
                                                                                                   
                                                             
                                                             
                                                             
 //shift(myLabelsTemp)  
                                                             

                                                             
                                                             
    for(var j=1;  j<=myIncoming.length-1; j++ ){  
      Lab2 =     myInSplit[j].pop()                                                                                                                     
     document.getElementById('myText02').value    +=  Lab2+'\n'  
     document.getElementById('myArea01').value  +=   myInSplit[j]+'\n'                                                         
                                                             
 }
       document.getElementById('myArea01').value.trim()
       document.getElementById('myText02').value.trim()                                                      
                                                             
   //for(var k=1;  k<=myInSplit.length-1; k++ ){                                                           
                                                             
     //}       
                                         
                                                             
}"><br><br>



<table border=1>
<tr><th colsspan=2>Headings:</th><td></td></tr>
<tr>
<td >
<textarea id="myText03" rows=1 cols=70 nowrap placeholder="length, width, height">
Size, Weight</textarea>

</td><td id='myLabelsSpot'></td></tr>

<tr><th>Data:</th><th>Labels</th></tr>

<tr><td><textarea id="myArea01" rows=10 cols=70 nowrap placeholder="length,width,height,label&#10;2,3,4,small&#10;4,6,7,big">
1.0, 34
9.8, 88
5.0, 67
6.0, 57
7.0, 77
2.3, 14
12.1, 99
15.1, 123</textarea></td><td>


<textarea id="myText02" rows=10 cols=20 nowrap onScroll="{alert()}" placeholder="length,width,height,label&#10;2,3,4,small&#10;4,6,7,big">
small
big
medium
medium
medium
small
big
big</textarea></td></tr>
</table>

The K value: <input id="myKvalue" type=text value="3" placeholder="5"><br>
The unknown: <input id="myText01" type=text value="3.5, 56" placeholder="4.2, 5.1, 8.6"><br>

<br>
<input  type="button" value="Solve K-Nearest-Neigbor" onclick="{

  (async function (){
   myMainArray = document.getElementById('myArea01').value.split(/\r\n|\n/);  // split at end of line
                                                    
   //myData = dl.tensor1d(myMainArray); 
   myUnknown = dl.tensor1d(document.getElementById('myText01').value.split(',')); 
                                           
   myHeadingsArray = document.getElementById('myText03').value.split(',')



//////////////////////////////////////////////////////////////////// issues


   // Need to load the data
   myDataArray = new Array(myHeadingsArray.length)


   for (myA=0;  myA <= myMainArray.length-1 ; myA++){
        myDataArray[myA] = myMainArray[myA].split(',')
     
   }

 //alert(JSON.stringify(myDataArray))  // shows javascript array with squarebrackets

   //myData = dl.tensor1d(flatten(myDataArray),'float32', [5,2]); 
   myData = dl.tensor(myDataArray); 


//////////////////////////////////////////////////////////////

 



   myLabelsArray = document.getElementById('myText02').value.split(/\r\n|\n/);
 


   //myLabelsArray.length

   myOriginalLoc = new Array(myLabelsArray.length)
   for (x=0;  x <= myLabelsArray.length-1; x++ ){
      myOriginalLoc[x] = x
   }     
   
    
  // check K value less than amount of data
    if (document.getElementById('myKvalue').value > myLabelsArray.length){
        alert('Forcing K value to less than data points')
        document.getElementById('myKvalue').value = myLabelsArray.length
     }

                                                  
 myData.print('verbose')
      document.getElementById('myDiv02').innerHTML =  'myData tensor is [' + await myData.data() +']<br>'   
      document.getElementById('myDiv02').innerHTML +=  'Length ' + myLabelsArray.length + ', myLabels tensor is [' + myLabelsArray +']<br>'   
      document.getElementById('myDiv02').innerHTML +=  'myUnknown tensor is [' + await myUnknown.data() +']<br>'  


      // Got to grab the shape to setup a pow sqrt tensor       

      //alert(myLabelsArray.length)
      //alert(myHeadingsArray.length)
      myMainShape = new Array(2)
      myMainShape[0] =myLabelsArray.length  
      myMainShape[1] = myHeadingsArray.length
      //alert(JSON.stringify(myMainShape))
  
      //const mySqrt = dl.tensor1d([0.5, 0.5, 0.5, 0.5, 0.5]);                                                                             
      const mySqrt = dl.fill([myLabelsArray.length], 0.5)                                                             
     // const mySqrt = dl.fill(myMainShape, 0.5)         // thought I needed multi-dimensional squareRoot, but will sum tensor first


 
      //mySqrt.print('verbose')
    
      const myDiff = dl.sub(myData, myUnknown);   
      const mySquaredDiff = dl.mul(myDiff, myDiff);
     
      const axis = 1;
      const mySquaredDiffAdded = mySquaredDiff.sum(axis);
 
      const myKNN = mySquaredDiffAdded.pow(mySqrt) 
      myKnnArray = await myKNN.data()                                                                            
                                                                                       
      document.getElementById('myDiv02').innerHTML +=  'The KNN tensor is [' + myKnnArray +']<br>'

      //myKnnArray = await myKNN.buffer()
      
          myKNN.print('verbose')                                                          
       //alert(myKnnArray)                                           
      // alert(myLabelsArray)                                           
      // alert(myOriginalLoc)                                                             
                                                                    
      myJoinedArray = new Array(myLabelsArray.length)

      for (y=0; y <= myLabelsArray.length-1; y++){
         myJoinedArray[y] = new Array(3)
      }




      myJoinedArray = myJoinedArray.map(function(value, index){
            return [myKnnArray[index], myLabelsArray[index], myOriginalLoc[index]];
         })

                                   
       //alert(myJoinedArray)      









// sort the triple array of KNN, label, location in original array                                            
                                            
  myJoinedArray.sort(function(a,b){
     return a[0] - b[0];
  });
                                            

  myTemp=''
  myLabelAverage = ''
  myLabelGroup = new Array(myLabelsArray.length)    
  myLabelGroup[0] = new Array(2)                                            
  myGrouping = 0;        

  myUniqueLables = Array.from(new Set(myLabelsArray))  
  myCount = new Array() 
  for (h=0;  h<= myUniqueLables.length-1; h++){
       myCount[h]=0
   }                                         
    // alert(myLabelsArray)
    // alert(myUniqueLables)  






                                    
for (c=0;  c <= parseInt(document.getElementById('myKvalue').value)-1;   c++){
   myTemp += myMainArray[myJoinedArray[c][2]] +', '                                            
    //alert(myJoinedArray[c][2])
                                            

          for (h=0;  h<= myUniqueLables.length-1; h++){
            if (myJoinedArray[c][1] == myUniqueLables[h]){
               myCount[h] += 1
            }
          }
       

                                                     
                                            
  }                                            

// alert(myTemp+', LabelArrayCount = '+ myUniqueLables[findIndexOfGreatest(myCount)])                                                 




  document.getElementById('myDiv02').innerHTML +=  '<br>For the unknown: <font color=green>'+document.getElementById('myText01').value+
        '</font> the K-Nearest-Neighbors : <font color=blue>'+myTemp+'</font> Best Label = <font color=blue>'+myUniqueLables[findIndexOfGreatest(myCount)] +'</font><br>'   
    

    
   })()


}"><br><br>







<div id="myDiv02">...<br></div><br>

