



<script src="https://unpkg.com/deeplearn@0.5.1/dist/deeplearn.js"> </script> 
Version 1 <br><br>
<h2 align=center>CSV to K Nearest Neighbor (KNN) Classifier</h2>



<script>
// helper function for very last step
function findIndexOfGreatest(array) {
  var greatest;
  var indexOfGreatest;
  for (var i = 0; i < array.length; i++) {
    if (!greatest || array[i] > greatest) {
      greatest = array[i];
      indexOfGreatest = i;
    }
  }
  return indexOfGreatest;
}
</script>



Original CSV:<br><textarea id="myArea02" rows=10 cols=50 nowrap placeholder="length,width,height,label&#10;2,3,4,small&#10;4,6,7,big">
sepal_length,sepal_width,petal_length,petal_width,species
5.1,3.5,1.4,0.2,setosa
4.9,3,1.4,0.2,setosa
4.7,3.2,1.3,0.2,setosa
</textarea><br>

<input type=button value="Seperate Data and Labels" onclick="{
 
  alert('not yet ready\nUsing the testing data below') 

}"><br><br>






The Headings: <input id="myText03" size=70 type=text value="Size" placeholder="legnth, width, height"><br>


Data: <br><textarea id="myArea01" rows=10 cols=70 nowrap placeholder="length,width,height,label&#10;2,3,4,small&#10;4,6,7,big">
1.0
9.8
5.0
2.3
12.1
</textarea><br>


The Labels: <textarea id="myText02" rows=10 cols=20 nowrap placeholder="length,width,height,label&#10;2,3,4,small&#10;4,6,7,big">
small
big
medium
small
big
</textarea><br>


The K value: <input id="myKvalue" type=text value="3" placeholder="5"><br>
The unknown: <input id="myText01" type=text value="3.5" placeholder="4.2, 5.1, 8.6"><br>


<input  type="button" value="Solve K-Nearest-Neigbor" onclick="{

  (async function (){
   myMainArray = document.getElementById('myArea01').value.split('\n')  // split at end of line
                                                    
   myData = dl.tensor1d(myMainArray); 
   myUnknown = dl.tensor1d(document.getElementById('myText01').value.split(',')); 
                                           
   myHeadingsArray = document.getElementById('myText03').value.split(',')
   myLabelsArray = document.getElementById('myText02').value.split('\n')
   
   myLabelsArray.length
   myOriginalLoc = new Array(myLabelsArray.length)
   for (x=0;  x <= myLabelsArray.length-1; x++ ){
      myOriginalLoc[x] = x
   }     
   
    
  // check K value less than amount of data
    if (document.getElementById('myKvalue').value > myLabelsArray.length){
        alert('Forcing K value to less than data points')
        document.getElementById('myKvalue').value = myLabelsArray.length-1
     }

                                                  
 
      document.getElementById('myDiv02').innerHTML =  'myData tensor is [' + await myData.data() +']<br>'   
      document.getElementById('myDiv02').innerHTML +=  'Length ' + myLabelsArray.length + ', myLabels tensor is [' + myLabelsArray +']<br>'   
      document.getElementById('myDiv02').innerHTML +=  'myUnknown tensor is [' + await myUnknown.data() +']<br><br>'  


  
      //const mySqrt = dl.tensor1d([0.5, 0.5, 0.5, 0.5, 0.5]);                                                                             
      const mySqrt = dl.fill([myLabelsArray.length], 0.5)

    
      const myDiff = dl.sub(myData, myUnknown);   
      const mySquaredDiff = dl.mul(myDiff, myDiff);
      const myKNN = mySquaredDiff.pow(mySqrt) 
      myKnnArray = await myKNN.data()                                                                            
                                                                                       
      document.getElementById('myDiv02').innerHTML +=  'The KNN tensor is [' + myKnnArray +']<br>'

      //myKnnArray = await myKNN.buffer()
      
                                                                    
       //alert(myKnnArray)                                           
      // alert(myLabelsArray)                                           
      // alert(myOriginalLoc)                                                             
                                                                    
      myJoinedArray = new Array(myLabelsArray.length)

      for (y=0; y <= myLabelsArray.length-1; y++){
         myJoinedArray[y] = new Array(3)
      }




      myJoinedArray = myJoinedArray.map(function(value, index){
            return [myKnnArray[index], myLabelsArray[index], myOriginalLoc[index]];
         })

                                   
       //alert(myJoinedArray)      









// sort the triple array of KNN, label, location in original array                                            
                                            
  myJoinedArray.sort(function(a,b){
     return a[0] - b[0];
  });
                                            

  myTemp=''
  myLabelAverage = ''
  myLabelGroup = new Array(myLabelsArray.length)    
  myLabelGroup[0] = new Array(2)                                            
  myGrouping = 0;        

  myUniqueLables = Array.from(new Set(myLabelsArray))  
  myCount = new Array() 
  for (h=0;  h<= myUniqueLables.length-1; h++){
       myCount[h]=0
   }                                         
    // alert(myLabelsArray)
    // alert(myUniqueLables)  






                                    
for (c=0;  c <= parseInt(document.getElementById('myKvalue').value)-1;   c++){
   myTemp += myMainArray[myJoinedArray[c][2]] +', '                                            
    //alert(myJoinedArray[c][2])
                                            

          for (h=0;  h<= myUniqueLables.length-1; h++){
            if (myJoinedArray[c][1] == myUniqueLables[h]){
               myCount[h] += 1
            }
          }
       
                                                     
                                            
  }                                            

// alert(myTemp+', LabelArrayCount = '+ myUniqueLables[findIndexOfGreatest(myCount)])                                                 




  document.getElementById('myDiv02').innerHTML +=  '<br>K Nearest Neighbors : '+myTemp+' Best Label = '+myUniqueLables[findIndexOfGreatest(myCount)] +'<br>'   
    

    
   })()


}"><br><br>







<div id="myDiv02">...<br></div><br>


